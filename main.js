(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{I5:()=>W,kq:()=>B,mh:()=>Z,kW:()=>t});var t,n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-8",headers:{Authorization:"79f162b1-a586-4458-ae35-5979e9a8f77a","Content-type":"application/json"}},o=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},r={buttonSubmit:".popup__button-save",buttonSubmitInvalid:"popup__button-save_disabled",input:".popup__input",inputInvalid:"popup__input_type_error",spanInvalid:"popup__input-error_active",form:".popup__form",pattern:/^([а-яА-ЯёЁa-zA-Z]|\s|-|\n)+$/,patternMessage:"Допустимы только латинские буквы, кириллические буквы, знаки дефиса или пробелы"},a=function(e,t){u(e)?c(t):i(t)},c=function(e){e.disabled=!0,e.classList.add(r.buttonSubmitInvalid)},i=function(e){e.disabled=!1,e.classList.remove(r.buttonSubmitInvalid)},u=function(e){return e.some((function(e){return!e.validity.valid||!r.pattern.test(e.value)&&"url"!==e.type}))},l=function(e,t){t.validity.valid?r.pattern.test(t.value)||"url"===t.type?d(e,t):s(e,t,r.patternMessage):s(e,t,t.validationMessage)},s=function(e,t,n){var o=e.querySelector(".".concat(t.name,"-error"));t.classList.add(r.inputInvalid),o.textContent=n,o.classList.add(r.spanInvalid)},d=function(e,t){var n=e.querySelector(".".concat(t.name,"-error"));t.classList.remove(r.inputInvalid),n.textContent="",n.classList.remove(r.spanInvalid)},m=function(e){var t=e.querySelector(r.buttonSubmit),n=e.querySelector(r.form),o=Array.from(n.querySelectorAll(r.input));c(t),o.forEach((function(e){d(n,e)})),n.reset()},f=document.querySelector(".profile__title"),p=document.querySelector(".profile__subtitle"),v=document.querySelector(".profile__avatar"),_=document.querySelector(".elements"),y=document.querySelector(".profile__avatar-edit"),h=document.querySelector(".profile__edit-button"),b=document.querySelector(".profile__add-button"),S=document.querySelector("#popupAvatar"),L=document.querySelector("#popupProfile"),g=document.querySelector("#popupPlace"),q=document.querySelector("#popupImage"),k=document.forms.formProfile.profileName,E=document.forms.formProfile.profileAboutSelf,C=document.forms.formAvatar.avatarUrl,A=document.forms.formPlace.placeName,x=document.forms.formPlace.placeUrl,I=document.forms.formAvatar,P=document.forms.formProfile,T=document.forms.formPlace,U=document.querySelector(".popup__image"),w=document.querySelector(".popup__image-caption"),O=document.querySelector("#popupDelete"),j=document.querySelector("#deleteCardConfirm"),D=function(e){var n=document.querySelector("#elementTemplate").content.querySelector(".element").cloneNode(!0),o=n.querySelector(".element__title"),r=n.querySelector(".element__image"),a=n.querySelector(".element__like"),c=n.querySelector(".element__like-value");if(o.textContent=e.name,r.src=e.link,r.alt=e.name,c.textContent=e.likes.length,n.id=e._id,t===e.owner._id){var i=n.querySelector(".element__delete-button");i.removeAttribute("disabled"),i.classList.remove("element__delete-button_off")}return e.likes.forEach((function(e){t===e._id&&a.classList.add("element__like_active")})),n},N=function(e){var t=D(e);_.append(t)},M=function(e){e.classList.add("popup_opened"),document.addEventListener("click",W),document.addEventListener("mousedown",Z),document.addEventListener("keydown",B)},J=function(){var e=document.querySelector(".popup_opened");e.classList.remove("popup_opened"),document.removeEventListener("click",W),document.removeEventListener("mousedown",Z),document.removeEventListener("keydown",B),"popupImage"!==e.id&&"popupDelete"!==e.id&&setTimeout(m,300,e)},z=function(e){e.target.querySelector(".popup__button-save").textContent="Сохранение..."},H=function(e){e.target.querySelector(".popup__button-save").textContent="Сохранить"};function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}Array.from(document.forms).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(r.input)),n=e.querySelector(r.buttonSubmit);a(t,n),t.forEach((function(o){o.addEventListener("input",(function(){l(e,o),a(t,n)}))}))}(e)})),Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then(o),fetch("".concat(n.baseUrl,"/cards/"),{headers:n.headers}).then(o)]).then((function(e){var n,o,r=(o=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,c,i=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=a.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return i}}(n,o)||function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],c=r[1];f.textContent=a.name,p.textContent=a.about,v.src=a.avatar,t=a._id,c.forEach(N),document.querySelector(".page").classList.remove("page_disabled")})).catch((function(e){console.error(e)}));var W=function(e){e.target.classList.contains("popup__button-close")&&J()},Z=function(e){e.target.classList.contains("popup_opened")&&J()},B=function(e){"Escape"===e.code&&J()},F=function(e){var t;(t=e.id,fetch("".concat(n.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:n.headers}).then(o)).then((function(){J(),e.classList.add("animation__fadeOut"),setTimeout((function(){e.remove()}),700)})).catch((function(e){console.error(e)}))};document.addEventListener("click",(function(e){if(e.target.classList.contains("element__delete-button")&&!e.target.classList.contains("element__delete-button_off")){var t=e.target.closest(".element");M(O),j.addEventListener("click",(function(){F(t)}),{once:!0}),document.addEventListener("keydown",(function(e){"Enter"===e.key&&F(t)}),{once:!0})}})),document.addEventListener("click",(function(e){if(e.target.classList.contains("element__like")){var t=e.target.closest(".element"),r=t.querySelector(".element__like-value");e.target.classList.contains("element__like_active")?(a=t.id,fetch("".concat(n.baseUrl,"/cards/likes/").concat(a),{method:"DELETE",headers:n.headers}).then(o)).then((function(t){r.textContent=t.likes.length,e.target.classList.remove("element__like_active")})).catch((function(e){return console.error(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then(o)}(t.id).then((function(t){r.textContent=t.likes.length,e.target.classList.add("element__like_active")})).catch((function(e){return console.error(e)}))}var a})),I.addEventListener("submit",(function(e){e.preventDefault(),z(e),function(e){return fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:e.value})}).then(o)}(C).then((function(){v.src=C.value,J()})).catch((function(e){return console.error(e)})).finally((function(){setTimeout(H,300,e)}))})),P.addEventListener("submit",(function(e){e.preventDefault(),z(e),function(e,t){return fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:e.value,about:t.value})}).then(o)}(k,E).then((function(){f.textContent=k.value,p.textContent=E.value,J()})).catch((function(e){return console.error(e)})).finally((function(){setTimeout(H,300,e)}))})),T.addEventListener("submit",(function(e){e.preventDefault(),z(e);var t,r={};r.name=A.value,r.link=x.value,(t=r,fetch("".concat(n.baseUrl,"/cards/"),{method:"POST",headers:n.headers,body:JSON.stringify(t)}).then(o)).then((function(e){!function(e){var t=D(e);t.classList.add("animation__backInDown"),_.prepend(t)}(e),J()})).catch((function(e){console.error(e)})).finally((function(){setTimeout(H,300,e)}))})),document.addEventListener("click",(function(e){e.target.classList.contains("element__image")&&(U.src=e.target.src,U.alt=e.target.src,w.textContent=e.target.alt,M(q))})),y.addEventListener("click",(function(){M(S)})),h.addEventListener("click",(function(){k.value=f.textContent,E.value=p.textContent,M(L)})),b.addEventListener("click",(function(){M(g)}))})();